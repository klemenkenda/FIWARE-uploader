from time import sleep
from kafka import KafkaProducer
from json import dumps

producer = KafkaProducer(bootstrap_servers=['localhost:9092'],
                         value_serializer=lambda x: 
                         dumps(x).encode('utf-8'))

# ce kdaj ne dela posiljanje je loh problem prevec
# specificiranih topicov v configu
topic = "device_1efd_pred_output"

message = {
    "timestamp": 1646411654,
    "T": "2021-9-30 00:00:00",
    "WA": 5,
    "predicted_profile": [
        1001, 20.06004524230957, 20.008737564086914, 19.875843048095703, 19.826507568359375, 19.735532760620117, 19.671180725097656, 19.5283203125,
        19.510326385498047, 19.492237091064453, 19.43628692626953, 19.388273239135742, 19.338472366333008, 19.319091796875, 19.256969451904297, 19.23261833190918,
        19.15015411376953, 19.085248947143555, 19.03643798828125, 18.95341682434082, 18.859600067138672, 18.82411766052246, 18.832395553588867, 18.779903411865234,
        18.737533569335938, 18.738357543945312, 18.6993408203125, 18.649187088012695, 18.631242752075195, 18.578176498413086, 18.515640258789062, 18.49022674560547, 
        8.4593505859375, 18.4080810546875, 18.36920928955078, 18.322742462158203, 18.28092384338379, 18.259933471679688, 18.257587432861328, 18.249736785888672,
        18.24131202697754, 18.186418533325195, 18.17471694946289, 18.178691864013672, 18.179821014404297, 18.178245544433594, 18.152536392211914, 18.10913848876953,
        18.098995208740234, 18.047550201416016, 18.03350257873535, 18.02505111694336, 18.02481460571289, 18.030445098876953, 18.008752822875977, 17.996295928955078,
        17.965824127197266, 17.946840286254883, 17.954761505126953, 17.952289581298828, 17.913734436035156, 17.917055130004883, 17.907180786132812, 17.889965057373047,
        17.845775604248047, 17.8184871673584, 17.808422088623047, 17.79094123840332, 17.76633644104004, 17.75705337524414, 17.75811004638672, 17.7288818359375, 17.73082160949707,
        17.68035125732422, 17.673484802246094, 17.654333114624023, 17.68544578552246, 17.667369842529297, 17.688247680664062]}


# Message that tests different behaviour of uploader (if WA=-1) that ignores T and WA 
# since for the time being there is no need for watering 
message_null = {
    "timestamp": 1649397600, 
    "T": -1,
    "WA": -1,
    "predicted_profile": [
        32.45000076293945, 32.58053207397461, 32.51338195800781, 32.479373931884766, 32.633811950683594, 32.57728958129883, 32.57843780517578, 32.11187744140625, 32.37362289428711,
        32.09251022338867, 32.374427795410156, 32.28205108642578, 32.290504455566406, 32.27162170410156, 32.18943405151367, 32.30099868774414, 32.2423210144043, 32.1751823425293,
        32.062259674072266, 31.860870361328125, 31.9644718170166, 32.071861267089844, 32.121788024902344, 31.89889907836914, 31.83527374267578, 31.888687133789062, 32.08921813964844,
        31.886581420898438, 31.903278350830078, 31.730777740478516, 31.919357299804688, 31.81000518798828, 31.88269805908203, 31.757402420043945, 31.721202850341797, 31.71109390258789,
        31.575477600097656, 31.66083526611328, 31.67666244506836, 31.47198486328125, 31.64056396484375, 31.455265045166016, 31.54999542236328, 31.449848175048828, 31.676559448242188,
        31.448278427124023, 31.541183471679688, 31.515989303588867, 31.277849197387695, 31.254446029663086, 31.34754753112793, 31.427444458007812, 31.290836334228516, 31.3841609954834,
        31.340375900268555, 31.20262336730957, 31.38626480102539, 31.258668899536133, 31.20980453491211, 31.263103485107422, 31.50067901611328, 31.364330291748047, 31.14658546447754,
        31.275550842285156, 31.175247192382812, 31.35077667236328, 31.238988876342773, 31.119155883789062, 31.265457153320312, 31.031463623046875, 31.342763900756836, 31.277286529541016,
        31.23456573486328, 31.396221160888672, 31.16515350341797, 31.18756866455078, 31.126361846923828, 31.138378143310547, 30.949384689331055, 30.986783981323242
    ]
}

# Entitiy: urn:ngsi-ld:FlowerBed:FlowerBed-5

#producer.send(topic, value=message)
array = [
    "2021-9-30 00:00:00",
    "2021-10-1 00:00:00",
    "2021-10-2 00:00:00",
    "2021-10-3 00:00:00",
    "2021-10-4 00:00:00",
    "2021-10-5 00:00:00",
    "2021-10-6 00:00:00",
    "2021-10-7 00:00:00",
    "2021-10-8 00:00:00",
    "2021-10-9 00:00:00"
]

message = message_null
print(topic)
for i in range(100):
    print(i)
    message["timestamp"] = message["timestamp"] + 60000
    #message["WA"] = i
    #message["T"] = array[i]
    producer.send(topic, value=message)
    sleep(15)